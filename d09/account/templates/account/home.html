{% extends 'account/base.html' %}
{% block content %}
<div class="homepage">
  {% if user.is_authenticated %}
    <p>Logged as {{ user.username }}</p>
  {% else %}
  <form id="login-form" >
    {% csrf_token %}
    {% for field in form %}
    <label for="id_{{ field.name}}">{{field.name}}</label>
    <p>
      {{field}}
    </p>
    {% endfor %}
    <input type="submit" value="login">
    <p id="login-error"></p>
  </form>
  {% endif %}
  <p id="welcome-message"></p>
</div>
<script>
  document.querySelector("#login-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(document.querySelector("#login-form"));
        const params = {
            method: "POST",
            body: formData
        };

    const response = await fetch('/account/', params);
    const data = await response.json();

    if (data.code === 401) {
      document.querySelector("#login-error").innerHTML = data.content;
    } else if (data.code === 200) {
      document.querySelector("#login-form").innerHTML = ""
      document.querySelector("#welcome-message").innerHTML = data.content;
    }
  })
</script>
{% endblock content %}
